#!/bin/bash
if [ "_$1_" != "__" ]; then
	case $1 in
		-*)
			case $1 in
				*d*) PROJ_FUNCTION=dir;;
				*o*) PROJ_FUNCTION=go;;
				*st*) PROJ_FUNCTION=st;;
				*) PROJ_FUNCTION=row;;
			esac
			if [ "_$2_" != "__" ]; then PROJ_KEYWORD=$2; else PROJ_KEYWORD=def; fi;;
		*) PROJ_FUNCTION=row; PROJ_KEYWORD=$1;;
	esac
	KR_DIR_CFG=$(asetus dir:cfg)
	PROJ_ROW_N=_$(cat $KR_DIR_CFG/proj.csv|grep $PROJ_KEYWORD|wc -l)_
	case $PROJ_ROW_N in
		_0_) nada;;
		_1_) nada;;
		*) PROJ_KEYWORD=$PROJ_KEYWORD\,;;
	esac
	PROJ_ROW=$(cat $KR_DIR_CFG/proj.csv|grep $PROJ_KEYWORD)
	case $PROJ_FUNCTION in
		dir) echo $PROJ_ROW|awk -F\, '{print $4}';;
		row) echo $PROJ_ROW;;
		*)
			PROJ_DIR=$(echo $PROJ_ROW|awk -F\, '{print $4}')
			case $PROJ_DIR in
				~*) PROJ_HOME=~; PROJ_DIR=$PROJ_HOME$(echo $PROJ_DIR|awk -F\~ '{print $2}');;
			esac
			if [ -d $PROJ_DIR ]; then cd $PROJ_DIR; fi; case $PROJ_FUNCTION in
				st) projekti-status;;
				#*) open .;;
			esac;;
	esac
fi
