#!/usr/bin/env ruby
# frozen_string_literal: true

require 'thor'
require 'sqlite3'
require 'digest'

# HAKEMISTO class: scans contents of a dir and counts checksums.
class Hakemisto < Thor
  default_task :default

  desc 'default', 'default function.'
  def default(db_file = nil)
    db = database(db_file) # check filename?
    temp = system("asetus dir:temp")
    files.each do |f|
      summa_md5 = Digest::MD5.file file_path unless filename.nil?
      summa_256 = Digest::SHA256.file filename unless filename.nil?
      # checksums, add to DB
    end
    # FileUtils.mv("#{temp}/hakemisto.db", db_file)
  end

  desc 'duplicate', 'look for duplicates in the DB.'
  def duplicate(filename = nil)
    db_file = db_file || ENV['DB'] || 'hakemisto.db'
    db = database(db_file)
    if !filename.nil?
    summa_256 = Digest::SHA256.file filename unless filename.nil?
    summa_md5 = Digest::MD5.file file_path unless filename.nil?
    # checksum unless filename.nil?
  end

  desc 'missing', 'look for missing files in the DB.'
  def missing
    #
  end

  private

  def database(filename = nil)
    db_file = "#{db_file}/hakemisto.db" if File.directory?(db_file) && !db_file.nil?
    db_file = 'hakemisto.db' if db_file.nil?
    SQLite3::Database.open db_file
  end

end

Hakemisto.start(ARGV)
