#!/usr/bin/env ruby

require 'fileutils'
# require 'optparse'

# not sure if all of this is proper code yet. work in progress

# def varko(path = nil)
begin
  dir = options[:dir] || dir
  pw = options[:pw] || pw
  filename = options[:filename] || filename
  ignore = options[:ignore] || ignore # komennon parametri?
  FileUtils.cd(dir) unless dir.nil?
  log_old = system("loki latest --path #{dir}")
  if !log_old.include?(Today) # check formatting for today 
    temp = options[:temp] || system('asetus dir:temp')
    buc = system('asetus dir:buc')
    system("7z a #{dir} #{temp}/#{filename}.7z #{ignore}|tail -3|grep is") # tarkista
    summa = system("summa #{buc}/#{filename}.7z")
    if !log_old.include?(summa)
      system("mv #{temp}/#{filename}.7z #{buc}/#{filename}.cbc")
      system("loki add --path #{dir} #{filename} #{summa}")
      system("tynnyri #{filename}")
    end
    #rm #{temp}/#{filename}.7z if FIle.exists("#{temp}/#{filename}.7z")
  end
rescue File::Error => e
  puts e.message
end
