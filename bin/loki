#!/usr/bin/env ruby
require 'thor'
require 'fileutils'
require 'date'

# Loki here is named after the finnish word 'loki', meaning a log(file).
class Loki < Thor
  default_task :latest

  desc "add PATH", "add a log line to backup.log in PATH"
  long_desc <<-LONGDESC
    `loki add` will add a log line to backup.log in PATH.
  LONGDESC
  def add(path=nil)
    unless path.nil? then FileUtils.cd(path); end
    #add a line to PATH/backup.log
  end

  desc "latest PATH", "print latest backup date for PATH"
  long_desc <<-LONGDESC
    `loki latest` will print out the latest backup date for PATH.
  LONGDESC
  def latest(path=nil)
    unless path.nil? then FileUtils.cd(path); end
    #if exists backup.log
    today_date = `tail -1 backup.log` #retrieves the last line of backup.log using system tools
    #else/elif/end
    puts today_date
  end

  desc "today PATH", "print true if backup has been run for PATH today"
  long_desc <<-LONGDESC
    `loki today` will print out a boolean value about if backup for PATH has been run today.
  LONGDESC
  def today(path=nil)
    latest_date = latest(path).to_s.include? Date.today.to_s
    puts latest_date
  end
end

Loki.start(ARGV)
