#!/bin/sh

kanta_param() {
	case $1 in
		-*) case $1 in
				*a:*) KANTA_FUNCTION=add; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*cf*:*) CFG=$(echo $1|awk -F\: '{print $2}');;
				*cr:*) KANTA_FUNCTION=create; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*db:*) DB=$(echo $1|awk -F\: '{print $2}');;
				*del:*) KANTA_FUNCTION=remove;;
				*f:*) KANTA_FUNCTION=search; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*g:*) KANTA_FUNCTION=create; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*i:*) KANTA_FUNCTION=add; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*l:*) KANTA_FUNCTION=search; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*n:*) KANTA_FUNCTION=count; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*s:*) KANTA_FUNCTION=search; KANTA_TABLE=$(echo $1|awk -F\: '{print $2}');;
				*st) KANTA_FUNCTION=status;;
				*t) KANTA_FUNCTION=status; KANTA_FILTER=TABLE;;
				*u) KANTA_FUNCTION=update;;
				*x) KANTA_FUNCTION=status; KANTA_FILTER=INDEX;;
			esac;;
		*) KANTA_SEARCH=$1;;
	esac
}

if [ "_$1_" != "__" ]; then
	KANTA_FUNCTION=search
	kanta_param "$1"
	if [ "_$2_" != "__" ]; then
		kanta_param "$2"
		if [ "_$3_" != "__" ]; then kanta_param "$3"; fi
	fi
else
	KANTA_FUNCTION=status
fi

if [ "_$(echo $DB)_" != "__" ]; then
	case $KANTA_FUNCTION in
		add) sqlite3 $DB "INSERT INTO $KANTA_TABLE values($KANTA_SEARCH);";;
		count) sqlite3 $DB "SELECT Count(*) FROM $KANTA_TABLE;";;
		create) sqlite3 $DB "CREATE TABLE $KANTA_TABLE ($KANTA_SEARCH);";;
		remove) echo sqlite $DB delete "(where $KANTA_REMOVE)";;
		search) if [ "_$(echo $KANTA_SEARCH)_" != "__" ]; then sqlite3 $DB "SELECT * FROM $KANTA_TABLE;" | grep $KANTA_SEARCH; else sqlite3 $DB "SELECT * FROM $KANTA_TABLE;"; fi;;
		status) if [ "_$(echo $KANTA_FILTER)_" != "__" ]; then sqlite3 $DB .schema|grep $KANTA_FILTER; else sqlite3 $DB .schema; fi;;
		update) echo sqlite $DB edit;;
	esac
else
	virhe DB $DB not defined
fi
