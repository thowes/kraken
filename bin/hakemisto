#!/bin/bash

if [ -d "$1" ]; then cd "$1"; fi
if [ -f changed.lst ]; then nada; else
	if [ -f changed.old ]; then mv changed.old changed.lst; fi
	if [ -f changed.log ]; then mv changed.log changed.lst; fi
fi
if [ -f duplicate.lst ]; then nada; else
	if [ -f duplicate.old ]; then mv duplicate.old duplicate.lst; fi
	if [ -f duplicate.log ]; then mv duplicate.log duplicate.lst; fi
fi
if [ -f hakemisto.lst ]; then nada; else
	if [ -f levy.old ]; then mv levy.old hakemisto.lst; fi
	if [ -f levy.log ]; then mv levy.log hakemisto.lst; fi
	if [ -f levy.lst ]; then mv levy.lst hakemisto.lst; fi
fi
DIR="."; TEMP=$(asetus dir:temp); INIT_STRING="$HOSTNAME $(pwd) $(pvm)" #pvm=date +"%F %R"
echo $INIT_STRING > $TEMP/changed.lst
echo $INIT_STRING > $TEMP/duplicate.lst
echo $INIT_STRING > $TEMP/hakemisto.lst
echo $INIT_STRING > $TEMP/indb.lst
echo $INIT_STRING > $TEMP/junk.lst
ls -1R > $TEMP/ls.lst
while read p; do
	case $p in
		".:") DIR=".";;
		"./"*":"*) DIR=$(echo "$p"|awk -F':' '{ print $1 $2 }');; #\
		*"._"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"backup.log"*) nada;;
		*"changed.log"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"changed.lst"*) nada;;
		*"cover.jpg"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"cover.png"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*".DS_Store"*) echo "$DIR/$p" >> $TEMP/junk.lst;; 
		*"duplicate.log"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"duplicate.lst"*) nada;;
		*"esktop.ini"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"hakemisto.lst"*) nada;;
		*"humbs.db"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"junk.lst"*) nada;;
		*"Icon"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"indb.lst"*) nada;;
		*"levy.log"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"levy.lst"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"LOCK"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"ls.lst"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		*"Notes.txt"*) echo "$DIR/$p" >> $TEMP/junk.lst;;
		"total "*) nada;;
		*)
			FILE=$DIR/$(echo $p|awk -F'*' '{ print $1 }'); 
			if [ -d "$FILE" ]; then nada; else
				SUMMA=$(summa "$FILE"); RIVI=$SUMMA,$FILE
				if [ $(kannassa "$FILE") == "false" ]; then echo "$SUMMA,$FILE" >> $TEMP/indb.lst; fi
				if [ -f hakemisto.lst ]; then
					RIVIT=$(cat hakemisto.lst | grep "$SUMMA")
					if [ "$SUMMA,$FILE" == "$RIVIT" ]; then nada; else
						echo "$RIVIT" | grep -v "$RIVI" >> $TEMP/duplicate.lst
					fi
				fi
				#META_META=$(TIME_STYLE=long-iso ls -l)
				echo "$SUMMA,$FILE" >> $TEMP/hakemisto.lst
			fi;;
	esac
done < $TEMP/ls.lst
mv $TEMP/changed.lst .
mv $TEMP/duplicate.lst .
mv $TEMP/hakemisto.lst .
mv $TEMP/indb.lst .
mv $TEMP/junk.lst .
if [ -f $TEMP/changed.lst ]; then rm $TEMP/changed.lst; fi
if [ -f $TEMP/duplicate.lst ]; then rm $TEMP/duplicate.lst; fi
if [ -f $TEMP/hakemisto.lst ]; then rm $TEMP/hakemisto.lst; fi
if [ -f $TEMP/indb.lst ]; then rm $TEMP/indb.lst; fi
if [ -f $TEMP/junk.lst ]; then rm $TEMP/junk.lst; fi
if [ -f $TEMP/ls.lst ]; then rm $TEMP/ls.lst; fi
if [ -f $TEMP/puuttuu.lst ]; then rm $TEMP/puuttuu.lst; fi
if [ -f $TEMP/roskat.lst ]; then rm $TEMP/roskat.lst; fi
