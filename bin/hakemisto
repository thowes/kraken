#!/bin/bash
if [ -d "$1" ]; then cd "$1"; fi
if [ -f changed.log ]; then mv changed.log changed.lst; fi
if [ -f duplicate.log ]; then mv duplicate.log duplicate.lst; fi
if [ -f levy.lst ]; then mv levy.lst hakemisto.lst; fi
DIR_DIR="."; DIR="."; DIR_TEMP=$(asetus dir:temp); TEMP=$(asetus dir:temp)
pwd > $TEMP/changed.lst
pwd > $TEMP/duplicate.lst
pwd > $TEMP/hakemisto.lst
pwd > $TEMP/junk.lst
ls -1R > $TEMP/ls.lst
while read p; do
	case $p in
		".:") DIR_DIR="."; DIR=".";;
		"./"*":"*) DIR_DIR=$(echo "$p"|awk -F':' '{ print $1 $2 }'); DIR="$DIR_DIR";; #\
		*"backup.log"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"changed.log"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"changed.lst"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*".DS_Store"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;; 
		*"duplicate.log"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"duplicate.lst"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"esktop.ini"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"hakemisto.lst"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"humbs.db"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"junk.lst"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"levy.log"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"levy.lst"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		*"ls.lst"*) echo "$DIR_DIR/$p" >> $DIR_TEMP/junk.lst;;
		"total "*) nada;;
		*) DIR=$DIR_DIR;
			FILE=$DIR/$(echo $p|awk -F'*' '{ print $1 }'); 
			if [ -d "$FILE" ]; then debug "$FILE"; else
				SUMMA=$(summa "$FILE")
				cat hakemisto.lst | grep "$SUMMA" | grep -v "$FILE" >> $TEMP/duplicate.lst #| tr -s " " #
				#META_META=$(TIME_STYLE=long-iso ls -l)
				echo "$SUMMA,$FILE" >> $TEMP/hakemisto.lst
			fi;;
	esac
done < $TEMP/ls.lst
mv $TEMP/changed.lst .
mv $TEMP/duplicate.lst .
mv $TEMP/hakemisto.lst .
mv $TEMP/junk.lst .
if [ -f $TEMP/changed.log ]; then rm $TEMP/changed.log; fi
if [ -f $TEMP/changed.lst ]; then rm $TEMP/changed.lst; fi
if [ -f $TEMP/duplicate.log ]; then rm $TEMP/duplicate.log; fi
if [ -f $TEMP/duplicate.lst ]; then rm $TEMP/duplicate.lst; fi
if [ -f $TEMP/hakemisto.lst ]; then rm $TEMP/hakemisto.lst; fi
if [ -f $TEMP/junk.lst ]; then rm $TEMP/junk.lst; fi
if [ -f $TEMP/levy.lst ]; then rm $TEMP/levy.lst; fi
if [ -f $TEMP/ls.lst ]; then rm $TEMP/ls.lst; fi
